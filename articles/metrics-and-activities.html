<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Metrics and Activities | ProDataGrid for Avalonia </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Metrics and Activities | ProDataGrid for Avalonia ">
      
      
      <link rel="icon" href="../favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      
      
      
      <meta name="docfx:docurl" content="https://github.com/wieslawsoltes/ProDataGrid/blob/master/docfx/articles/metrics-and-activities.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="metrics-and-activities">Metrics and Activities</h1>

<p>ProDataGrid exposes OpenTelemetry-friendly diagnostics via <code>ActivitySource</code> and <code>Meter</code> so you can track row generation, virtualization, selection changes, and collection view operations. The diagnostics can be consumed in-process (OpenTelemetry) or streamed out-of-process using the ProDiagnostics UDP transport and viewer.</p>
<h2 id="enabling-diagnostics">Enabling diagnostics</h2>
<p>Diagnostics are opt-in. Enable them early in app startup (before any grids are created):</p>
<pre><code class="lang-csharp">AppContext.SetSwitch(&quot;ProDataGrid.Diagnostics.IsEnabled&quot;, true);
</code></pre>
<h2 id="installation">Installation</h2>
<p>Install the transport library from NuGet:</p>
<pre><code class="lang-bash">dotnet add package ProDiagnostics.Transport
</code></pre>
<p>Install the viewer as a global tool:</p>
<pre><code class="lang-bash">dotnet tool install -g prodiagnostics-viewer
</code></pre>
<p>To update later:</p>
<pre><code class="lang-bash">dotnet tool update -g prodiagnostics-viewer
</code></pre>
<h2 id="transport-prodiagnostics-udp-stream">Transport: ProDiagnostics UDP stream</h2>
<p><code>ProDiagnostics.Transport</code> provides a lightweight UDP protocol for streaming telemetry to an out-of-process viewer.</p>
<p>What it does:</p>
<ul>
<li>Sends <code>Hello</code> packets (session identity) plus Activity and Metric packets.</li>
<li>Uses a binary protocol (<code>TelemetryProtocol.Version == 1</code>) capped at 64 KB per datagram.</li>
<li>Supports tag limits (<code>MaxTagsPerMessage</code>) and wildcard filtering for source/meter names (<code>*</code> and <code>?</code> patterns).</li>
<li>Ignores malformed packets on the receiver so the stream stays resilient.</li>
</ul>
<h3 id="exporter-usage">Exporter usage</h3>
<pre><code class="lang-csharp">using ProDiagnostics.Transport;

var exporter = new DiagnosticsUdpExporter(new DiagnosticsUdpOptions
{
    Host = &quot;127.0.0.1&quot;,
    Port = TelemetryProtocol.DefaultPort,
    HelloInterval = TimeSpan.FromSeconds(5),
    MaxTagsPerMessage = 32,
    IncludeActivityTags = true,
    IncludeMetricTags = true,
    ActivitySourceNames = new[] { &quot;ProDataGrid.*&quot; },
    MeterNames = new[] { &quot;ProDataGrid.Diagnostic.Meter&quot; }
});

exporter.Start();
</code></pre>
<p>Keep the exporter alive for the lifetime of the app and dispose it during shutdown.</p>
<h2 id="viewer-app">Viewer app</h2>
<p><code>ProDiagnostics.Viewer</code> is an Avalonia app that listens for UDP packets and visualizes them.</p>
<p>Run it from the repo:</p>
<pre><code class="lang-bash">dotnet run --project src/ProDiagnostics.Viewer/ProDiagnostics.Viewer.csproj
</code></pre>
<p>Viewer features:</p>
<ul>
<li>Session list populated from <code>Hello</code> packets (app name, process, machine, runtime).</li>
<li>UDP port selection with pause/resume.</li>
<li>Preset selection + reload (JSON files).</li>
<li>Metrics and activities filters (name + alias matching).</li>
<li>Column visibility toggles with resize/reorder in both grids.</li>
<li>Metric sparklines + detailed tabs (double-click a metric row).</li>
<li>Detail chart with min/avg/max thresholds based on the current window, plus pan/zoom and time-range selection.</li>
</ul>
<h2 id="presets">Presets</h2>
<p>Presets are JSON files that live in a <code>Presets</code> folder. The viewer loads:</p>
<ul>
<li>Built-in presets from <code>Assets/Presets</code> in the app output.</li>
<li>User presets from <code>%APPDATA%/ProDiagnostics.Viewer/Presets</code> (create the folder if it doesn't exist).</li>
</ul>
<p>Preset example:</p>
<pre><code class="lang-json">{
  &quot;name&quot;: &quot;ProDataGrid&quot;,
  &quot;description&quot;: &quot;Focus on ProDataGrid diagnostics&quot;,
  &quot;includeActivities&quot;: [
    &quot;ProDataGrid.*&quot;
  ],
  &quot;includeMetrics&quot;: [
    &quot;prodatagrid.*&quot;
  ],
  &quot;metricAliases&quot;: {
    &quot;prodatagrid.refresh.time&quot;: &quot;Refresh Time&quot;
  },
  &quot;activityAliases&quot;: {
    &quot;ProDataGrid.DataGrid.RefreshRowsAndColumns&quot;: &quot;Refresh Rows + Columns&quot;
  }
}
</code></pre>
<h2 id="activitysource">ActivitySource</h2>
<p>ActivitySource name: <code>ProDataGrid.Diagnostic.Source</code></p>
<p>Activities emitted:</p>
<ul>
<li><code>ProDataGrid.DataGrid.RefreshRowsAndColumns</code></li>
<li><code>ProDataGrid.DataGrid.RefreshRows</code></li>
<li><code>ProDataGrid.DataGrid.UpdateDisplayedRows</code></li>
<li><code>ProDataGrid.DataGrid.GenerateRow</code></li>
<li><code>ProDataGrid.DataGrid.AutoGenerateColumns</code></li>
<li><code>ProDataGrid.DataGrid.SelectionChanged</code></li>
<li><code>ProDataGrid.CollectionView.Refresh</code></li>
<li><code>ProDataGrid.CollectionView.Filter</code></li>
<li><code>ProDataGrid.CollectionView.Sort</code></li>
<li><code>ProDataGrid.CollectionView.Group</code></li>
<li><code>ProDataGrid.CollectionView.GroupTemporary</code></li>
<li><code>ProDataGrid.CollectionView.GroupPage</code></li>
</ul>
<p>Example listener:</p>
<pre><code class="lang-csharp">using System.Diagnostics;

var listener = new ActivityListener
{
    ShouldListenTo = source =&gt; source.Name == &quot;ProDataGrid.Diagnostic.Source&quot;,
    Sample = static (ref ActivityCreationOptions&lt;ActivityContext&gt; _) =&gt; ActivitySamplingResult.AllDataAndRecorded,
    ActivityStopped = activity =&gt;
    {
        // Inspect activity.DisplayName and activity.Tags
    }
};

ActivitySource.AddActivityListener(listener);
</code></pre>
<h2 id="metrics">Metrics</h2>
<p>Meter name: <code>ProDataGrid.Diagnostic.Meter</code></p>
<p>Histograms (ms):</p>
<ul>
<li><code>prodatagrid.refresh.time</code> - DataGrid refresh pass (rows + columns).</li>
<li><code>prodatagrid.rows.refresh.time</code> - Row refresh pass.</li>
<li><code>prodatagrid.rows.display.update.time</code> - Displayed rows update during virtualization.</li>
<li><code>prodatagrid.rows.generate.time</code> - Row generation and preparation.</li>
<li><code>prodatagrid.columns.autogen.time</code> - Auto-generated columns pass.</li>
<li><code>prodatagrid.selection.change.time</code> - SelectionChanged handling.</li>
<li><code>prodatagrid.collection.refresh.time</code> - Collection view refresh.</li>
<li><code>prodatagrid.collection.filter.time</code> - Filtering during refresh.</li>
<li><code>prodatagrid.collection.sort.time</code> - Sorting during refresh.</li>
<li><code>prodatagrid.collection.group.time</code> - Grouping during refresh.</li>
<li><code>prodatagrid.collection.group.temporary.time</code> - Temporary grouping for paging.</li>
<li><code>prodatagrid.collection.group.page.time</code> - Page-level grouping.</li>
</ul>
<p>Counters:</p>
<ul>
<li><code>prodatagrid.rows.realized.count</code> - Row containers realized.</li>
<li><code>prodatagrid.rows.recycled.count</code> - Row containers recycled.</li>
<li><code>prodatagrid.rows.prepared.count</code> - Row containers prepared.</li>
<li><code>prodatagrid.columns.autogen.count</code> - Columns auto-generated.</li>
<li><code>prodatagrid.selection.changed.count</code> - SelectionChanged events raised.</li>
</ul>
<h2 id="tags">Tags</h2>
<p>Activities include context tags such as:</p>
<ul>
<li><code>ClearRows</code>, <code>RecycleRows</code>, <code>AutoGenerateColumns</code></li>
<li><code>Columns</code>, <code>Rows</code>, <code>SlotCount</code></li>
<li><code>DisplayHeight</code>, <code>FirstDisplayedSlot</code>, <code>LastDisplayedSlot</code>, <code>DisplayedSlots</code></li>
<li><code>RowIndex</code>, <code>Slot</code>, <code>Source</code> (<code>existing</code>, <code>new</code>, <code>recycled</code>, <code>own-container</code>)</li>
<li><code>AddedCount</code>, <code>RemovedCount</code>, <code>SelectionSource</code>, <code>UserInitiated</code></li>
<li><code>SortDescriptions</code>, <code>GroupDescriptions</code>, <code>FilterEnabled</code></li>
<li><code>PageSize</code>, <code>PageIndex</code>, <code>UsesLocalArray</code>, <code>IsGrouping</code></li>
<li><code>AutoGeneratedColumns</code></li>
</ul>
<p>Counters use <code>Source</code> for row realization and <code>SelectionSource</code> for selection changes.</p>
<h2 id="opentelemetry-integration">OpenTelemetry integration</h2>
<pre><code class="lang-csharp">services.AddOpenTelemetry()
    .WithTracing(builder =&gt; builder.AddSource(&quot;ProDataGrid.Diagnostic.Source&quot;))
    .WithMetrics(builder =&gt; builder.AddMeter(&quot;ProDataGrid.Diagnostic.Meter&quot;));
</code></pre>
<h2 id="notes">Notes</h2>
<ul>
<li>Diagnostics are off by default; set the switch before any grid usage.</li>
<li>UDP is best-effort and can drop packets; it is intended for live observability, not guaranteed delivery.</li>
<li>Some metrics are nested (for example refresh includes filter/sort/group), so compare like-for-like scenarios.</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/wieslawsoltes/ProDataGrid/blob/master/docfx/articles/metrics-and-activities.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
