<!-- Copyright (c) Wiesław Šoltés. All rights reserved. -->
<!-- Licensed under the MIT license. See LICENSE file in the project root for details. -->
<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:Avalonia.Controls">
  <!-- Fluent v2 keeps the v1 styling and only swaps the DataGrid template to the ScrollViewer-based version.
       All colors, column/cell themes, and resources continue to come from Fluent.xaml. -->
  <StyleInclude Source="/Themes/Fluent.xaml" />
  <Styles.Resources>
   <ResourceDictionary>
    <ControlTheme x:Key="{x:Type DataGrid}"
                  TargetType="DataGrid"
                  BasedOn="{StaticResource {x:Type DataGrid}}">
      <Setter Property="UseLogicalScrollable" Value="True" />
      <Setter Property="Template">
        <ControlTemplate>
          <Border x:Name="DataGridBorder"
                  Background="{TemplateBinding Background}"
                  BorderBrush="{TemplateBinding BorderBrush}"
                  BorderThickness="{TemplateBinding BorderThickness}"
                  CornerRadius="{TemplateBinding CornerRadius}">
            <Grid RowDefinitions="Auto,Auto,*,Auto"
                  ClipToBounds="True">
              
              <!-- Column Headers Row (stays fixed at top) -->
              <Grid Grid.Row="0" ColumnDefinitions="Auto,*">
                <DataGridColumnHeader Name="PART_TopLeftCornerHeader"
                                      Theme="{StaticResource DataGridTopLeftColumnHeader}" />
                <DataGridColumnHeadersPresenter Name="PART_ColumnHeadersPresenter"
                                                Grid.Column="1" />
              </Grid>
              
              <Rectangle Name="PART_ColumnHeadersAndRowsSeparator"
                         Grid.Row="0"
                         VerticalAlignment="Bottom"
                         Height="1"
                         Fill="{DynamicResource DataGridGridLinesBrush}" />

              <!-- ScrollViewer wrapping the RowsPresenter -->
              <Grid Grid.Row="2">
                <ScrollViewer Name="PART_ScrollViewer"
                              HorizontalScrollBarVisibility="{TemplateBinding HorizontalScrollBarVisibility}"
                              VerticalScrollBarVisibility="{TemplateBinding VerticalScrollBarVisibility}"
                              IsScrollInertiaEnabled="{TemplateBinding IsScrollInertiaEnabled}"
                              AllowAutoHide="True">
                  <DataGridRowsPresenter Name="PART_RowsPresenter" />
                </ScrollViewer>
                <controls:DataGridSelectionOverlay Name="PART_SelectionOverlay"
                        ClipToBounds="True"
                        IsHitTestVisible="True"
                        Panel.ZIndex="5">
                  <Border Name="PART_SelectionOutline"
                          BorderBrush="{DynamicResource DataGridSelectionOutlineBrush}"
                          BorderThickness="{DynamicResource DataGridSelectionOutlineThickness}"
                          Background="{x:Null}"
                          IsHitTestVisible="False"
                          IsVisible="False"
                          Width="0"
                          Height="0" />
                  <Border Name="PART_FillHandle"
                          Width="{DynamicResource DataGridFillHandleSize}"
                          Height="{DynamicResource DataGridFillHandleSize}"
                          Background="{DynamicResource DataGridFillHandleBrush}"
                          BorderBrush="{DynamicResource DataGridSelectionOutlineBrush}"
                          BorderThickness="1"
                          CornerRadius="1"
                          Cursor="Cross"
                          IsVisible="False" />
                </controls:DataGridSelectionOverlay>
              </Grid>

              <!-- Total Summary Row (fixed at bottom) -->
              <controls:DataGridSummaryRow Name="PART_TotalSummaryRow"
                                  Grid.Row="3"
                                  IsVisible="False" />

              <!-- Disabled overlay -->
              <Border x:Name="PART_DisabledVisualElement"
                      Grid.Row="0" Grid.RowSpan="4"
                      IsHitTestVisible="False"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      CornerRadius="{TemplateBinding CornerRadius}"
                      Background="{DynamicResource DataGridDisabledVisualElementBackground}"
                      IsVisible="{Binding !$parent[DataGrid].IsEnabled}" />
            </Grid>
          </Border>
        </ControlTemplate>
      </Setter>

      <Style Selector="^:summary-top /template/ controls|DataGridSummaryRow#PART_TotalSummaryRow">
        <Setter Property="Grid.Row" Value="1" />
      </Style>

      <Style Selector="^:empty-columns">
        <Style Selector="^ /template/ DataGridColumnHeader#PART_TopLeftCornerHeader">
          <Setter Property="IsVisible" Value="False" />
        </Style>
        <Style Selector="^ /template/ DataGridColumnHeadersPresenter#PART_ColumnHeadersPresenter">
          <Setter Property="IsVisible" Value="False" />
        </Style>
        <Style Selector="^ /template/ Rectangle#PART_ColumnHeadersAndRowsSeparator">
          <Setter Property="IsVisible" Value="False" />
        </Style>
      </Style>
    </ControlTheme>
   </ResourceDictionary>
  </Styles.Resources>
</Styles>
