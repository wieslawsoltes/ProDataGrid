<!--
  Copyright (c) Wiesław Šoltés. All rights reserved.
  Licensed under the MIT license. See LICENSE file in the project root for details.
-->
<UserControl
    x:Class="DataGridSample.Pages.HierarchicalFlyoutSelectionPage"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:DataGridSample.ViewModels"
    xmlns:hier="clr-namespace:Avalonia.Controls.DataGridHierarchical;assembly=Avalonia.Controls.DataGrid"
    x:DataType="viewModels:HierarchicalFlyoutSelectionViewModel"
    d:DesignHeight="720"
    d:DesignWidth="1100"
    mc:Ignorable="d">

  <UserControl.DataContext>
    <viewModels:HierarchicalFlyoutSelectionViewModel />
  </UserControl.DataContext>

  <Grid Margin="12"
        RowDefinitions="Auto,*"
        RowSpacing="8">
    <StackPanel Spacing="4">
      <TextBlock Classes="h2" Text="SelectionModel in a Flyout" />
      <TextBlock TextWrapping="Wrap"
                 Text="DropDownButton opens a Flyout containing a hierarchical DataGrid bound to SelectionModel. The view model listens to SelectionModel.SelectionChanged." />
    </StackPanel>

    <Grid Grid.Row="1"
          ColumnDefinitions="2*,*"
          ColumnSpacing="12">
      <StackPanel Spacing="8">
        <StackPanel Orientation="Horizontal"
                    Spacing="6">
          <TextBlock Text="Last selection:"
                     VerticalAlignment="Center" />
          <TextBlock Text="{Binding LastSelection}"
                     FontWeight="Bold"
                     VerticalAlignment="Center" />
        </StackPanel>

        <DropDownButton Width="280"
                        HorizontalAlignment="Left">
          <DropDownButton.Content>
            <StackPanel Spacing="2">
              <TextBlock Text="Open destination picker"
                         FontWeight="SemiBold" />
              <TextBlock Text="Select a folder inside the flyout grid"
                         Foreground="{DynamicResource SystemControlForegroundBaseMediumHighBrush}"
                         FontSize="12" />
            </StackPanel>
          </DropDownButton.Content>

          <DropDownButton.Flyout>
            <Flyout ShowMode="Transient"
                    Placement="BottomEdgeAlignedLeft">
              <Border Padding="8"
                      MaxWidth="720"
                      MaxHeight="460"
                      MinWidth="420">
                <ContentControl Content="{Binding FolderDestinationManager}">
                  <ContentControl.ContentTemplate>
                    <DataTemplate x:DataType="viewModels:ItemFolderDestinationManagerViewModel">
                      <DataGrid Height="400"
                                AutoGenerateColumns="False"
                                HierarchicalRowsEnabled="True"
                                Classes="hierarchical"
                                HierarchicalModel="{Binding HierarchicalModel}"
                                Selection="{Binding SelectionModel, Mode=OneTime}"
                                SelectionMode="Extended"
                                HeadersVisibility="Column"
                                GridLinesVisibility="Horizontal"
                                x:DataType="viewModels:ItemFolderDestinationManagerViewModel">
                        <DataGrid.Columns>
                          <DataGridHierarchicalColumn Width="2*"
                                                      Header="Folder"
                                                      x:CompileBindings="False"
                                                      Binding="{Binding Item}">
                            <DataGridHierarchicalColumn.CellTemplate>
                              <DataTemplate x:DataType="viewModels:ItemFolderDestinationViewModel">
                                <TextBlock Text="{Binding Name}" />
                              </DataTemplate>
                            </DataGridHierarchicalColumn.CellTemplate>
                          </DataGridHierarchicalColumn>

                          <DataGridTemplateColumn x:CompileBindings="False"
                                                  Width="140"
                                                  Header="Children">
                            <DataGridTemplateColumn.CellTemplate>
                              <DataTemplate x:DataType="hier:HierarchicalNode">
                                <TextBlock x:DataType="viewModels:ItemFolderDestinationViewModel"
                                           DataContext="{Binding Item}"
                                           Text="{Binding Folders.Count}" />
                              </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                          </DataGridTemplateColumn>
                        </DataGrid.Columns>
                      </DataGrid>
                    </DataTemplate>
                  </ContentControl.ContentTemplate>
                </ContentControl>
              </Border>
            </Flyout>
          </DropDownButton.Flyout>
        </DropDownButton>

        <TextBlock TextWrapping="Wrap"
                   Text="Try selecting rows inside the flyout. The SelectionModel hooks in the view model should log every change." />
      </StackPanel>

      <StackPanel Grid.Column="1"
                  Spacing="8">
        <TextBlock Classes="h3"
                   Text="SelectionModel.SelectionChanged log" />
        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="4">
          <ListBox Height="320"
                   ItemsSource="{Binding SelectionLog}" />
        </Border>
        <TextBlock TextWrapping="Wrap"
                   Text="If the event does not fire when hosted in a Flyout, this list will remain empty and the 'Last selection' label will stay at 'None'." />
      </StackPanel>
    </Grid>
  </Grid>
</UserControl>
